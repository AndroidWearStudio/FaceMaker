<!doctype html>
<html>
<head>
  <title>FaceMaker for Facer</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  <!-- CSS -->
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.2.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="css/facemaker.css">
</head>
<body>
  <nav class="navbar navbar-default" role="navigation">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
          <span class="sr-only">Toggle Navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a href="#" class="navbar-brand">FaceMaker for Facer</a>
      </div>
      <div class="collapse navbar-collapse" id="navbar">
        <div class="navbar-form navbar-left">
          <button class="btn btn-default" type="button" id="new_face">New Face</button>
          <button class="btn btn-default" type="button" id="load_face" data-toggle="modal" data-target="#load_modal">Load Face</button>
          <button class="btn btn-default" type="button" id="download_face">Save</button>
        </div>
        <div class="navbar-form navbar-right">
          <select id="example_faces" class="form-control">
            <option>Example Faces</option>
            <option value="angleface.face">Angle Face</option>
            <option value="executive-blue.face">Executive Blue</option>
            <option value="f-face.face">F-Face</option>
            <option value="meteoface-fixed.face">Meteoface - Fixed</option>
            <option value="meteoface-time.face">Meteoface - Time</option>
            <option value="nightmare-before-christmas.face">Nightmare Before Christmas</option>
            <option value="wearnow.face">Wear Now</option>
            <option value="test-face.face">Reverse Engineering Test</option>
          </select>
        </div>
      </div>
    </div>
  </nav>
  <div class="container">
    <div class="row">
      <!-- Preview -->
      <div class="col-lg-5 col-lg-push-7">
        <div class="row">
          <div class="col-lg-12">
            <canvas width="320" height="320" id="preview"></canvas>
          </div>
        </div>

        <!-- Test Options -->
        <div class="row">
          <div class="col-lg-12 form-horizontal">
            <h3>Test Options</h3>
            <div class="form-group">
              <div class="col-lg-8 col-lg-offset-4 checkbox">
                <label>
                  <input type="checkbox" id="low_power_mode">
                  Dimmed display (low power)
                </label>
              </div>
            </div>
            <div class="form-group">
              <div class="col-lg-8 col-lg-offset-4 checkbox">
                <label>
                  <input type="checkbox" id="fake_date_time">
                  Fake date and time
                </label>
              </div>
            </div>
            <div class="form-group">
              <label class="control-label col-lg-4">Fake date</label>
              <div class="col-lg-8">
                <input type='date' class="form-control" id="fake_date">
              </div>
            </div>
            <div class="form-group">
              <label class="control-label col-lg-4">Fake time</label>
              <div class="col-lg-8">
                <input type="time" class="form-control" id="fake_time">
              </div>
            </div>
          </div>
        </div>
        <!-- /Test Options -->

      </div>

      <!-- Editor -->
      <div class="col-lg-7 col-lg-pull-5 form-horizontal" id="editor">
      </div>
  
    </div>
    <div class="well well-sm">
      <div class="row">
        <div class="col-lg-12">
          <h2>Help</h2>
        </div>
      </div>
      <div class="row" id="help">
        <div class="col-lg-4">
          <h4>Time Related Variables</h4>
          <dl class="dl-horizontal">

          </dl>
        </div>
        <div class="col-lg-4">
          <h4>Battery</h4>
          <dl class="dl-horizontal">

          </dl>

          <h4>Wear</h4>
          <dl class="dl-horizontal">

          </dl>
        </div>
        <div class="col-lg-4">
          <h4>Weather</h4>
          <dl class="dl-horizontal">

          </dl>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="load_modal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button class="close" type="button" data-dismiss="modal">
            <span aria-hidden="true">&times;</span>
          </button>

          <h4 class="modal-title">Load a face from a .zip or .face file</h4>
        </div>

        <div class="modal-body" id="load_drop">
          <p>Drag and drop a .face or .zip file here to load it</p>
          <p>Or select a file <input type="file" id="load_file"></p>
          <p>
            <span style="display:none;" id="file_loading">Loading...</span>
          </p>
        </div>

      </div>
    </div>
  </div>
  <!-- Javascript -->
  <script type="text/ractive" id="editor-template">
  {{#face}}

    {{#description}}
    <div class="row">
      <div class="col-lg-12">
        <label class="control-label col-lg-3">Title</label>
        <div class="col-lg-9">
          <input type="text" class="form-control" value="{{title}}">
        </div>
      </div>
    </div>
    {{/description}}

    <div class="panel-group" id="editor-layers">
      {{#watchface:index}}
      <div class="panel panel-default">
        <div class="panel-heading">
            <button class="text-danger close" on-click="removeLayer">&times;</button>
          <a href="#editor-layer-{{index}}" data-toggle="collapse" data-parent="#editor-layers">
            <h4 class="panel-title">Layer {{id}} - {{type}}</h4>
          </a>
        </div>

        <div class="panel-collapse collapse" id="editor-layer-{{index}}" >
          {{>Editor}}
        </div>
      </div>
      {{/watchface}}
    </div>


    {{#images}}
      {{#each images:hash}}
        <image name="{{hash}}" src="{{img.src}}" width="{{img.width}}" height="{{img.height}}"/>
      {{/each}}
    {{/images}}

    {{#fonts}}
      {{#each fonts:font_name}}
        <font name="{{name}}" data="{{data}}"/>
      {{/each}}
    {{/fonts}}
  {{/face}}

  <div class="form-group text-right">
    <div class="col-lg-12">
      Add new 
      <div class="btn-group">
        <button type="button" class="btn btn-default" on-click="call:add_shape">Shape</button>
        <button type="button" class="btn btn-default" on-click="call:add_image">Image</button>
        <button type="button" class="btn btn-default" on-click="call:add_text">Text</button>
      </div>
    </div>
  </div>

  <!-- Partials, for later use -->
  <!-- {{>Editor}} -->
  {{#if type == 'shape'}}
    {{>shapeEditor}}
  {{/if}}
  {{#if type == 'text'}}
    {{>textEditor}}
  {{/if}}
  {{#if type == 'image'}}
    {{>imageEditor}}
  {{/if}}
  <!-- {{/Editor}} -->

  <!-- {{>textEditor}} -->
  <div class="row">
    <div class="col-lg-6">
      {{>field_text}}
      {{>field_x_y}}
      {{>field_color}}
      {{>field_low_power_color}}
      {{>field_bgcolor}}
    </div>

    <div class="col-lg-6">
      {{>field_text_alignment}} 
      {{>field_text_transform}}
      {{>field_opacity}}
      {{>field_rotation}}

      {{>field_size}}
      {{>field_font}}
      {{>field_italic}}
      {{>field_bold}}

      {{>field_low_power}}
    </div>
  </div>
  <!-- {{/textEditor}} -->

  <!-- {{>shapeEditor}} -->
  <div class="row">
    <div class="col-lg-6">
      {{>field_shape_type}}
      {{>field_radius}}
      {{>field_shape_opt}}
      
      {{#if shape_opt == 1}}
        {{>field_stroke}}
      {{/if}}
      
      {{>field_color}}
      {{>field_opacity}}
    </div>
    <div class="col-lg-6">
      {{#if shape_type == 2}}
        {{>field_sides}}
      {{/if}}
      {{>field_x_y}}
      {{#if shape_type == 1 || shape_type == 3}}
        {{>field_width_height}}
      {{/if}}
      {{>field_rotation}}
      {{>field_low_power}}
    </div>
  </div>
  <!-- {{/shapeEditor}} -->

  <!-- {{>imageEditor}} -->
    {{>field_image_selector}}
    <div class="row">
      <div class="col-lg-6">
        {{>field_width_height}}
        {{>field_opacity}}
      </div>
      <div class="col-lg-6">
        {{>field_image_alignment}}
        {{>field_x_y}}
        {{>field_rotation}}
        {{>field_low_power}}
      </div>
    </div>
  <!-- {{/imageEditor}} -->

  <!-- {{>field_text}} -->
    <div class="form-group">
      <label class="control-label col-lg-3">Text</label>
      <div class="col-lg-9">
        <input class="form-control" value="{{text}}">
      </div>
    </div>
  <!-- {{/field_text}} -->

  <!-- {{>field_text_alignment}} -->
      <div class="form-group">
        <label class="control-label col-lg-3">Alignment</label>
        <div class="col-lg-9">
          <select class="form-control" type="number" value='{{alignment}}'>
            <option value="0">Left</option>
            <option value="1">Center</option>
            <option value="2">Right</option>
          </select>
        </div>
      </div>
  <!-- {{/field_text_alignment}} -->

  <!-- {{>field_text_transform}} -->
      <div class="form-group">
        <label class="control-label col-lg-3">Transform</label>
        <div class="col-lg-9">
          <select class="form-control" type="number" value='{{transform}}'>
            <option value='0'>None</option>
            <option value='1'>Uppercase</option>
            <option value='2'>Lowercase</option>
          </select>
        </div>
      </div>
  <!-- {{/field_text_transform}} -->

  <!-- {{>field_size}} -->
      <div class="form-group">
        <label class="control-label col-lg-3">Size</label>
        <div class="col-lg-9">
          <input class="form-control" value="{{size}}">
        </div>
      </div>
  <!-- {{/field_size}} -->

  <!-- {{>field_font}} -->
      <div class="form-group">
        <label class="control-label col-lg-3">Font</label>
        <div class="col-lg-9">
          <select class="form-control" value="{{font_hash}}">
            <option value="">No custom font</option>
            {{#each fonts}}
              <optgroup style="font-family: {{name}}" label="{{filename}}">
                <option value="{{filename}}">{{filename}}</option>
              </optgroup>
            {{/each}}
          </select>
        </div>
      </div>
  <!-- {{/field_font}} -->

  <!-- {{>field_italic}} -->
      <div class="form-group">
        <div class="col-lg-9 col-lg-push-3 checkbox">
          <label class="control-label">
            <input type="checkbox" checked="{{italic}}">
            Italics
          </label>
        </div>
      </div>
  <!-- {{/field_italic}} -->

  <!-- {{>field_bold}} -->
      <div class="form-group">
        <div class="col-lg-9 col-lg-push-3 checkbox">
          <label class="control-label">
            <input type="checkbox" checked="{{bold}}">
            Bold
          </label>
        </div>
      </div>
  <!-- {{/field_bold}} -->

  <!-- {{>field_shape_type}} -->
    <div class="form-group">
      <label class="control-label col-lg-3">Type</label>
      <div class="col-lg-9">
        <select value="{{shape_type}}" class="form-control">
          <option value="0">Circle</option>
          <option value="1">Square</option>
          <option value="2">Polygon</option>
          <option value="3">Line</option>
          <option value="4">Triangle</option>
        </select>
      </div>
    </div>
  <!-- {{/field_shape_type}} -->

  <!-- {{>field_radius}} -->
    <div class="form-group">
      <label class="control-label col-lg-3">Radius</label>
      <div class="col-lg-9">
        <input type="text" class="form-control" value="{{radius}}">
      </div>
    </div>
  <!-- {{/field_radius}} -->

  <!-- {{>field_shape_opt}} -->
    <div class="form-group">
      <label class="control-label col-lg-3">Fill</label>
      <div class="col-lg-9">
        <select class="form-control" value="{{shape_opt}}">
          <option value="0">Fill</option>
          <option value="1">Stroke</option>
        </select>
      </div>
    </div>
  <!-- {{/field_shape_opt}} -->

  <!-- {{>field_stroke}} -->
    <div class="form-group">
      <label class="control-label col-lg-3">Stroke</label>
      <div class="col-lg-9">
        <input type="text" class="form-control" value="{{stroke_size}}">
      </div>
    </div>
  <!-- {{/field_stroke}} -->

  <!-- {{>field_color}} -->
    <div class="form-group">
      <label class="control-label col-lg-4">Color</label>
      <div class="col-lg-8">
        <color argb="{{color}}" class="form-control"/>
      </div>
    </div>
  <!-- {{/field_color}} -->

  <!-- {{>field_bgcolor}} -->
    <div class="form-group">
      <label class="control-label col-lg-4">BG Color</label>
      <div class="col-lg-8">
        <color argb="{{bgcolor}}" class="form-control"/>
      </div>
    </div>
  <!-- {{/field_bgcolor}} -->

  <!-- {{>field_low_power_color}} -->
    <div class="form-group">
      <label class="control-label col-lg-4">Dim Color</label>
      <div class="col-lg-8">
        <color argb="{{low_power_color}}" class="form-control"/>
      </div>
    </div>
  <!-- {{/field_low_power_color}} -->

  <!-- {{>field_sides}} -->
    <div class="form-group">
      <label class="control-label col-lg-3">Sides</label>
      <div class="col-lg-9">
        <input type="text" value="{{sides}}" class="form-control">
      </div>
    </div>
  <!-- {{/field_sides}} -->

  <!-- {{>field_image_selector}} -->
    <div class="form-group">
      <label class="control-label col-lg-3">Image</label>
      <div class="col-lg-9">
        <div class="image-dropdown form-control">
          <div class="selected image-{{hash}}"></div>
          <div class="options">
          {{#each images:img_hash}}
            <label class="image-{{img_hash}}">
              <input type="radio" name="{{hash}}" value="{{img_hash}}">
            </label>
          {{/each}}
          </div>
        </div>
      </div>
    </div>
  <!-- {{/field_image_selector}} -->

  <!-- {{>field_image_alignment}} -->
    <div class="form-group">
      <label class="control-label col-lg-3">Alignment</label>
      <div class="col-lg-9">
        <select class="form-control" type="number" value='{{alignment}}'>
          <option value="0">Top Left</option>
          <option value="1">Top Center</option>
          <option value="2">Top Right</option>
          <option value="3">Center Left</option>
          <option value="4">Center</option>
          <option value="5">Center Right</option>
          <option value="6">Bottom Left</option>
          <option value="7">Bottom Center</option>
          <option value="8">Bottom Right</option>
        </select>
      </div>
    </div>
  <!-- {{/field_image_alignment}} -->

  <!-- {{>field_low_power}} -->
    <div class="form-group">
      <div class="col-lg-9 col-lg-push-3 checkbox">
        <label class="control-label">
          <input type="checkbox" checked="{{low_power}}">
          Display when Dimmed
        </label>
      </div>
    </div>
  <!-- {{/field_low_power}} -->

  <!-- {{>field_x_y}} -->
    <div class="form-group">
      <label class="control-label col-lg-3">X Pos</label>
      <div class="col-lg-9">
        <input class="form-control" value="{{x}}">
      </div>
    </div>
    <div class="form-group">
      <label class="control-label col-lg-3">Y Pos</label>
      <div class="col-lg-9">
        <input class="form-control" value="{{y}}">
      </div>
    </div>
  <!-- {{/field_x_y}} -->

  <!-- {{>field_width_height}} -->
    <div class="form-group">
      <label class="control-label col-lg-3">Width</label>
      <div class="col-lg-9">
        <input type="text" value="{{width}}" class="form-control">
      </div>
    </div>
    <div class="form-group">
      <label class="control-label col-lg-3">Height</label>
      <div class="col-lg-9">
        <input type="text" value="{{height}}" class="form-control">
      </div>
    </div>
  <!-- {{/field_width_height}} -->

  <!-- {{>field_opacity}} -->
    <div class="form-group">
      <label class="control-label col-lg-3">Opacity</label>
      <div class="col-lg-9">
        <input class="form-control" value="{{opacity}}">
      </div>
    </div>
  <!-- {{/field_opacity}} -->

  <!-- {{>field_rotation}} -->
    <div class="form-group">
      <label class="control-label col-lg-3">Rotation</label>
      <div class="col-lg-9">
        <input type="text" value="{{r}}" class="form-control">
      </div>
    </div>
  <!-- {{/field_rotation}} -->

      
      

      <!-- Select Input
      <div class="row">
        <label class="control-label col-lg-3"></label>
        <div class="col-lg-9">
          <select class="form-control" type="number" value='{{}}'>
          </select>
        </div>
      </div>
      -->

      <!-- Text Input
      <div class="row">
        <label class="control-label col-lg-3"></label>
        <div class="col-lg-9">
          <input class="form-control" value="{{}}">
        </div>
      </div>
      -->
      <!-- Checkbox
      <div class="row">
        <div class="col-lg-9 col-lg-push-3 checkbox">
          <label class="control-label">
            <input type="checkbox" checked="{{}}">
          </label>
        </div>
      </div>
      -->
  </script>

  <script src='//cdn.ractivejs.org/latest/ractive.js'></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.2.0/js/bootstrap.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jszip/2.4.0/jszip.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.0.0/FileSaver.min.js"></script>
  <script src="js/jszip-utils.min.js"></script>

  <script src="js/facemaker.js"></script>  
  <script src="js/facemaker.formatter.js"></script>
  <script src="js/facemaker.editor.js"></script>
  <script src="js/facemaker.zip.js"></script>

  <script>
    var fm = new FaceMaker({
      editor: '#editor',
      preview: '#preview',
      new_face: "#new_face",
      download_face: "#download_face"
    });

    $("#example_faces").change(function(e) {
      if(e.target.selectedIndex) {
        fm.load_face_ajax("examples/" + $(this).val());
      }
    }).val("nightmare-before-christmas.face").trigger("change");

    function load_file_input(e) { 
      var file = e.target.files[0],
          reader = new FileReader();

      e.target.setAttribute("disabled", true);

      $("#file_loading").show();

      reader.onload = function(f) {
        fm.load_face(f.target.result);
        e.target.removeAttribute("disabled");
        $("#load_modal").modal("hide")
        $("#file_loading").hide();
      }

      reader.readAsArrayBuffer(file);
    }

    $("#load_file").change(load_file_input);
    
    var $load_drop = $("#load_drop");
    $load_drop.on("dragover", function(e) {
      $load_drop.addClass("dropping");
      e.preventDefault();
    }).on("dragleave", function(e) {
      $load_drop.removeClass("dropping");
      e.preventDefault();

      window.dragleave = e;
    }).on("drop", function(e) {
      $load_drop.removeClass("dropping");
      e.preventDefault();

      var file = e.originalEvent.dataTransfer.files[0],
          reader = new FileReader();

      $("#file_loading").show();

      reader.onload = function(f) {
        console.log(f);

        fm.load_face(f.target.result);
        $("#file_loading").hide();
        $("#load_modal").modal("hide");
      }

      reader.readAsArrayBuffer(file);

      window.drop = e;
    });
  </script>
  <style id="font-config"></style>
</body>
</html>
